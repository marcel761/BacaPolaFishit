<!DOCTYPE html>
<html>
<head>
  <title>RNG Fish-It Simulator</title>
  <style>
    body { font-family: Arial; padding: 20px; background:#0f1724; color:white;}
    input { margin: 5px; padding:4px; border-radius:6px; border:1px solid #333; background:#0b1a27; color:white; }
    button { padding:8px 12px; border:none; border-radius:8px; cursor:pointer; margin:5px; font-weight:700; }
    #runBtn { background:#38bdf8; color:#042033; }
    #resetBtn { background:#ef4444; color:white; }
    pre { background:#0b1a27; padding:15px; border-radius:10px; }
  </style>
</head>
<body>

<h2>ðŸŽ£ RNG Fish-It Simulator (Pity + Continues + History Log)</h2>

<label>Rod Lucky (%): </label>
<input id="rod" value="760"><br>

<label>Bait Lucky (%): </label>
<input id="bait" value="320"><br>

<label>Jumlah mancing per run:</label>
<input id="tries" value="500"><br>

<button id="runBtn" onclick="simulate()">â–¶ Jalankan Simulasi</button>
<button id="resetBtn" onclick="resetAll()">ðŸ”„ Reset</button>

<pre id="output"></pre>

<script>
let pity = 0;
let totalMancing = 0;
let counts = {};
let initialized = false;
let runNumber = 0;

// HISTORY: menyimpan semua hasil run
let historyLogs = [];

let baseRarity = {
  "Common":    0.75,
  "Uncommon":  0.15,
  "Rare":      0.06,
  "Epic":      0.025,
  "Legendary": 0.008,
  "Mythic":    0.0008,
  "Secret":    1 / 4000000
};

function initCounters(){
  for (let r in baseRarity) counts[r] = 0;
  initialized = true;
}

function getAdjustedRarity() {
  let rod = parseFloat(document.getElementById("rod").value);
  let bait = parseFloat(document.getElementById("bait").value);

  let luckyMultiplier = 1 + (rod + bait) / 15000;
  let pityBonus = pity;

  let adjusted = {};
  for (let r in baseRarity) adjusted[r] = baseRarity[r] * luckyMultiplier;

  adjusted["Secret"] = baseRarity["Secret"] * luckyMultiplier + pityBonus;

  let sum = Object.values(adjusted).reduce((a,b)=>a+b, 0);
  for (let r in adjusted) adjusted[r] /= sum;

  return adjusted;
}

function rollRarity(adjusted){
  let x = Math.random();
  let acc = 0;
  for (let r in adjusted) {
    acc += adjusted[r];
    if (x <= acc) return r;
  }
  return "Common";
}

function simulate() {

  if (!initialized) initCounters();

  let tries = parseInt(document.getElementById("tries").value);
  totalMancing += tries;

  let localCount = {};
  for (let r in baseRarity) localCount[r] = 0;

  for (let i=0; i<tries; i++) {
    let adjusted = getAdjustedRarity();
    let r = rollRarity(adjusted);

    counts[r]++;
    localCount[r]++;

    if (r !== "Secret") pity += 0.00000003;
    else pity = 0;
  }

  runNumber++;
  saveHistory(runNumber, tries, localCount);
  updateOutput();
}

function saveHistory(run, tries, localCount){
  let logText = 
`RUN #${run}
Jumlah: ${tries}
Common: ${localCount.Common}
Uncommon: ${localCount.Uncommon}
Rare: ${localCount.Rare}
Epic: ${localCount.Epic}
Legendary: ${localCount.Legendary}
Mythic: ${localCount.Mythic}
Secret: ${localCount.Secret}
-----------------------------`;

  historyLogs.push(logText);
}

function updateOutput(){

  let t = "=== TOTAL AKUMULASI ===\n";
  t += `Total Mancing: ${totalMancing}\n`;
  t += `Pity Saat Ini: ${pity.toFixed(10)}\n\n`;

  for (let r in counts) t += `${r}: ${counts[r]}\n`;

  t += `\n\n=== HISTORY PER RUN ===\n\n`;
  historyLogs.forEach(log => t += log + "\n");

  document.getElementById("output").textContent = t;
}

function resetAll(){
  pity = 0;
  totalMancing = 0;
  runNumber = 0;
  historyLogs = [];
  initCounters();

  document.getElementById("output").textContent = "Semua data telah direset.\n";
}
</script>

</body>
</html>
